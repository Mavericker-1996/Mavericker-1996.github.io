<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>垃圾回收和内存泄漏 | Mavericker&#39;s Blog</title>
    <meta name="description" content="赵佐骑的个人博客，前端">
    <link rel="icon" href="/fav.ico">
  <script type="text/javascript">var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?5a982c6c5e0d0d786523e60a7a647022";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    
    <link rel="preload" href="/assets/css/0.styles.76307617.css" as="style"><link rel="preload" href="/assets/js/app.813c17b6.js" as="script"><link rel="preload" href="/assets/js/27.20ca2d83.js" as="script"><link rel="prefetch" href="/assets/js/12.e71bc87f.js"><link rel="prefetch" href="/assets/js/2.b8909fec.js"><link rel="prefetch" href="/assets/js/3.8d04fbbf.js"><link rel="prefetch" href="/assets/js/4.76cb4dbf.js"><link rel="prefetch" href="/assets/js/5.82846fcf.js"><link rel="prefetch" href="/assets/js/6.d026f6bc.js"><link rel="prefetch" href="/assets/js/7.614c0c26.js"><link rel="prefetch" href="/assets/js/8.91f64669.js"><link rel="prefetch" href="/assets/js/9.bd03efb0.js"><link rel="prefetch" href="/assets/js/10.b72941af.js"><link rel="prefetch" href="/assets/js/11.55c4af94.js"><link rel="prefetch" href="/assets/js/13.1b4e26a1.js"><link rel="prefetch" href="/assets/js/14.6ce88fa2.js"><link rel="prefetch" href="/assets/js/15.53815097.js"><link rel="prefetch" href="/assets/js/16.3d021803.js"><link rel="prefetch" href="/assets/js/17.ac6b335f.js"><link rel="prefetch" href="/assets/js/18.539a72e1.js"><link rel="prefetch" href="/assets/js/19.46c5d299.js"><link rel="prefetch" href="/assets/js/20.bbe25a47.js"><link rel="prefetch" href="/assets/js/21.b57b41b7.js"><link rel="prefetch" href="/assets/js/22.24104113.js"><link rel="prefetch" href="/assets/js/23.a1aadb14.js"><link rel="prefetch" href="/assets/js/24.7f66a479.js"><link rel="prefetch" href="/assets/js/25.0d998f42.js"><link rel="prefetch" href="/assets/js/26.0448ab80.js"><link rel="prefetch" href="/assets/js/28.56900e6e.js"><link rel="prefetch" href="/assets/js/29.580fb71b.js"><link rel="prefetch" href="/assets/js/30.9b752411.js"><link rel="prefetch" href="/assets/js/31.71a3e01f.js"><link rel="prefetch" href="/assets/js/32.633b1158.js"><link rel="prefetch" href="/assets/js/33.f80c8c22.js"><link rel="prefetch" href="/assets/js/34.f4d2a30d.js"><link rel="prefetch" href="/assets/js/35.3ad15739.js"><link rel="prefetch" href="/assets/js/36.324804a5.js"><link rel="prefetch" href="/assets/js/37.59925d68.js"><link rel="prefetch" href="/assets/js/38.e6f8d299.js"><link rel="prefetch" href="/assets/js/39.46060081.js"><link rel="prefetch" href="/assets/js/40.92805123.js"><link rel="prefetch" href="/assets/js/41.8516a958.js"><link rel="prefetch" href="/assets/js/42.985e6416.js"><link rel="prefetch" href="/assets/js/43.770aaa1a.js"><link rel="prefetch" href="/assets/js/44.56039045.js"><link rel="prefetch" href="/assets/js/45.07330c76.js"><link rel="prefetch" href="/assets/js/46.6d200ff4.js"><link rel="prefetch" href="/assets/js/47.2ecec06c.js"><link rel="prefetch" href="/assets/js/48.2a749d70.js"><link rel="prefetch" href="/assets/js/49.5defabfe.js"><link rel="prefetch" href="/assets/js/50.391c2931.js"><link rel="prefetch" href="/assets/js/51.823ddd3e.js"><link rel="prefetch" href="/assets/js/52.272e9779.js"><link rel="prefetch" href="/assets/js/53.dd41478f.js"><link rel="prefetch" href="/assets/js/54.bdd75c33.js"><link rel="prefetch" href="/assets/js/55.6713f330.js"><link rel="prefetch" href="/assets/js/56.19a9b3e2.js"><link rel="prefetch" href="/assets/js/57.30130f5c.js"><link rel="prefetch" href="/assets/js/58.63ce249b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76307617.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Mavericker's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/network/" class="nav-link">网络</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/basic/" class="nav-link router-link-active">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/javascript/pro/" class="nav-link">JavaScript专题</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/article/" class="nav-link">文章</a></div><div class="nav-item"><a href="/resume/" class="nav-link">个人简历</a></div><div class="nav-item"><a href="https://github.com/Mavericker-1996/Mavericker-1996.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/network/" class="nav-link">网络</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/basic/" class="nav-link router-link-active">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/javascript/pro/" class="nav-link">JavaScript专题</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/article/" class="nav-link">文章</a></div><div class="nav-item"><a href="/resume/" class="nav-link">个人简历</a></div><div class="nav-item"><a href="https://github.com/Mavericker-1996/Mavericker-1996.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/javascript/basic/" class="sidebar-link">JavaScript基础</a></li><li><a href="/javascript/basic/类型转换.html" class="sidebar-link">类型转换</a></li><li><a href="/javascript/basic/let和const.html" class="sidebar-link">let和const</a></li><li><a href="/javascript/basic/this相关.html" class="sidebar-link">this相关</a></li><li><a href="/javascript/basic/作用域链.html" class="sidebar-link">作用域链</a></li><li><a href="/javascript/basic/原型.html" class="sidebar-link">原型</a></li><li><a href="/javascript/basic/原型与继承.html" class="sidebar-link">继承  </a></li><li><a href="/javascript/basic/垃圾回收和内存泄漏.html" class="active sidebar-link">垃圾回收和内存泄漏</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#变量的生命周期" class="sidebar-link">变量的生命周期</a></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#垃圾回收机制" class="sidebar-link">垃圾回收机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#引用计数" class="sidebar-link">引用计数</a></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#标记清除" class="sidebar-link">标记清除</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#常见的内存泄漏举例" class="sidebar-link">常见的内存泄漏举例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#忘记声明的局部变量" class="sidebar-link">忘记声明的局部变量</a></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#闭包带来的内存泄漏" class="sidebar-link">闭包带来的内存泄漏</a></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#移除dom节点时候忘记移除暂存的值" class="sidebar-link">移除DOM节点时候忘记移除暂存的值</a></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#被遗忘的计时器" class="sidebar-link">被遗忘的计时器</a></li></ul></li><li class="sidebar-sub-header"><a href="/javascript/basic/垃圾回收和内存泄漏.html#chrome中查看" class="sidebar-link">chrome中查看</a></li></ul></li><li><a href="/javascript/basic/深拷贝与浅拷贝.html" class="sidebar-link">深拷贝与浅拷贝</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="垃圾回收和内存泄漏"><a href="#垃圾回收和内存泄漏" aria-hidden="true" class="header-anchor">#</a> 垃圾回收和内存泄漏</h1> <p>参考文章：</p> <p><a href="https://github.com/BooheeFE/weekly/issues/8" target="_blank" rel="noopener noreferrer">javaScript中的垃圾回收和内存泄漏<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://speakerdeck.com/addyosmani/javascript-memory-management-masterclass" target="_blank" rel="noopener noreferrer">JavaScript Memory Management Masterclass<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>在一部分语言中是提供了内存管理的接口的，例如C语言中的 <code>molloc()</code>和 <code>free()</code>; 而在 <code>JavaScript</code> 中会自动进行内存的分配和回收的，因为<strong>自动</strong>这两个字，就让很多的开发者认为我们是不需要去关心内存方面的问题，当然，这是一种错误的看法。关注内存的管理,避免内存的泄漏也是性能优化重要的一项。</p> <h2 id="变量的生命周期"><a href="#变量的生命周期" aria-hidden="true" class="header-anchor">#</a> 变量的生命周期</h2> <p><code>Javascript</code> 变量的生命周期要分开来看：</p> <p>对于全局变量，它的生命周期会持续到页面关闭（这就涉及到了后面要总结的内存泄漏的一种方式）。</p> <p>而对于局部变量，在所在的函数的代码执行之后，局部变量的生命周期结束。它所占用的内存会通过垃圾回收机制释放（即垃圾回收）。</p> <h2 id="垃圾回收机制"><a href="#垃圾回收机制" aria-hidden="true" class="header-anchor">#</a> 垃圾回收机制</h2> <p>垃圾回收通常有两种方式来实现：</p> <h3 id="引用计数"><a href="#引用计数" aria-hidden="true" class="header-anchor">#</a> 引用计数</h3> <p>这种算法在MDN文档中被称为最&quot;天真&quot;的垃圾回收算法；核心原理是: 判断一个对象是否要被回收就是要看是否还有引用指向它，如果是&quot;零引用&quot;，那么就回收。说这种算法天真，是因为它存在着较为严重的缺陷---循环引用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  o<span class="token punctuation">.</span>a <span class="token operator">=</span> o2<span class="token punctuation">;</span> <span class="token comment">// o 引用 o2</span>
  o2<span class="token punctuation">.</span>a <span class="token operator">=</span> o<span class="token punctuation">;</span> <span class="token comment">// o2 引用 o</span>

  <span class="token keyword">return</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这样当f()执行完本该释放o和o2两个变量，但是由于引用计数的缘故，本没有释放。</p> <p>首先要注意我们是在函数作用域中讨论的这个问题，而不是全局环境中。老版本的IE中的非<code>JavaScript</code>原生对象如 <code>DOM</code> 和 <code>BOM</code> 对象就采用的这种引用计数的策略。下面这种情况下就会出现内存泄漏：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> el <span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;some_element&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Obj <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myObj<span class="token punctuation">.</span>el <span class="token operator">=</span> el<span class="token punctuation">;</span>
el<span class="token punctuation">.</span>someObject <span class="token operator">=</span> Obj<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当然我们可以在不用的时候手动释放：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>myObj<span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span>someObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="标记清除"><a href="#标记清除" aria-hidden="true" class="header-anchor">#</a> 标记清除</h3> <p>这个算法把“对象是否不再需要”简化定义为“对象是否可以获得”。</p> <p>这个算法假定有一个根（root）的对象；在 <code>Javascript</code> 里，根是全局对象,对应于浏览器环境的 <code>window</code>， node环境的 <code>global</code>。垃圾回收器将定期从根开始，找所有从根开始引用的对象，然后找这些对象引用的对象…… 从根开始，垃圾回收器将找到所有可以获得的对象和收集所有不能获得的对象。</p> <p>这个算法相对于引用计数的优势在于，“有零引用的对象”总是不可获得的，但是相反却不一定，参考“循环引用”。</p> <p>从2012年起，所有现代浏览器都使用了标记-清除垃圾回收算法，都是在此基础上进行优化。所有对JavaScript垃圾回收算法的改进都是基于标记-清除算法的改进，并没有改进标记-清除算法本身和它对“对象是否不再需要”的简化定义。</p> <h2 id="常见的内存泄漏举例"><a href="#常见的内存泄漏举例" aria-hidden="true" class="header-anchor">#</a> 常见的内存泄漏举例</h2> <h3 id="忘记声明的局部变量"><a href="#忘记声明的局部变量" aria-hidden="true" class="header-anchor">#</a> 忘记声明的局部变量</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    b<span class="token operator">=</span><span class="token number">2</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b没有被声明!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>b</code> 没被声明,会变成一个全局变量,在页面关闭之前不会被释放.使用严格模式可以避免。</p> <h3 id="闭包带来的内存泄漏"><a href="#闭包带来的内存泄漏" aria-hidden="true" class="header-anchor">#</a> 闭包带来的内存泄漏</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> leaks <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> leak <span class="token operator">=</span> <span class="token string">'xxxxxx'</span><span class="token punctuation">;</span><span class="token comment">// 闭包中引用，不会被回收</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当然有时候我们是故意让这个变量保存在内存中的，但是要避免无意的时候造成的内存泄漏。</p> <h3 id="移除dom节点时候忘记移除暂存的值"><a href="#移除dom节点时候忘记移除暂存的值" aria-hidden="true" class="header-anchor">#</a> 移除DOM节点时候忘记移除暂存的值</h3> <p>如图：</p> <p><img src="/assets/img/domleak0.b12e29d7.png" alt="domleak0"></p> <p><img src="/assets/img/domleak.71c613b5.png" alt="dom leak"></p> <p>意思就是说子节点还保持着对父节点的引用，所以当父节点被remove掉时，并没有回收掉，需要把子节点设为null方可回收。</p> <p>下面这个动图可以加深理解：</p> <p><img src="/assets/img/domleak1.969cb28a.gif" alt></p> <ul><li>黄色是指直接被 js变量所引用，在内存里</li> <li>红色是指间接被 js变量所引用，如上图，refB 被 refA 间接引用，导致即使 refB 变量被清空，也是不会被回收的</li> <li>子元素 refB 由于 parentNode 的间接引用，只要它不被删除，它所有的父元素（图中红色部分）都不会被删除</li></ul> <h3 id="被遗忘的计时器"><a href="#被遗忘的计时器" aria-hidden="true" class="header-anchor">#</a> 被遗忘的计时器</h3> <p>在 JavaScript 中使用 <code>setInterval</code> 非常平常。一段常见的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> someResource <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'Node'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理 node 和 someResource</span>
        node<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>someResource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>此例说明了什么：与节点或数据关联的计时器不再需要，<code>node</code> 对象可以删除，整个回调函数也不需要了。可是，计时器回调函数仍然没被回收（计时器停止才会被回收）。同时，<code>someResource</code> 如果存储了大量的数据，也是无法被回收的。</p> <h2 id="chrome中查看"><a href="#chrome中查看" aria-hidden="true" class="header-anchor">#</a> chrome中查看</h2> <p>老版本的在 <code>Timeline</code> 中查看, 新版本的在 <code>performance</code> 中查看：</p> <p><img src="https://raw.githubusercontent.com/BooheeFE/weekly/master/assets/img/memory.jpeg" alt="image"></p> <p>步骤:</p> <ol><li>打开开发者工具 <code>Performance</code></li> <li>勾选 <code>Screenshots</code> 和 <code>memory</code></li> <li>左上角小圆点开始录制(record)</li> <li>停止录制</li></ol> <p>图中 <code>Heap</code> 对应的部分就可以看到内存在周期性的回落也可以看到垃圾回收的周期，如果垃圾回收之后的最低值(我们称为min)，min在不断上涨，那么肯定是有较为严重的内存泄漏问题。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/27.20ca2d83.js" defer></script><script src="/assets/js/app.813c17b6.js" defer></script>
  </body>
</html>
