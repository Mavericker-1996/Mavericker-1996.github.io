(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{180:function(t,s,a){t.exports=a.p+"assets/img/domleak0.b12e29d7.png"},181:function(t,s,a){t.exports=a.p+"assets/img/domleak.71c613b5.png"},182:function(t,s,a){t.exports=a.p+"assets/img/domleak1.969cb28a.gif"},227:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"垃圾回收和内存泄漏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收和内存泄漏","aria-hidden":"true"}},[this._v("#")]),this._v(" 垃圾回收和内存泄漏")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("在一部分语言中是提供了内存管理的接口的，例如C语言中的 "),a("code",[t._v("molloc()")]),t._v("和 "),a("code",[t._v("free()")]),t._v("; 而在 "),a("code",[t._v("JavaScript")]),t._v(" 中会自动进行内存的分配和回收的，因为"),a("strong",[t._v("自动")]),t._v("这两个字，就让很多的开发者认为我们是不需要去关心内存方面的问题，当然，这是一种错误的看法。关注内存的管理,避免内存的泄漏也是性能优化重要的一项。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"变量的生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#变量的生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" 变量的生命周期")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Javascript")]),this._v(" 变量的生命周期要分开来看：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"垃圾回收机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收机制","aria-hidden":"true"}},[this._v("#")]),this._v(" 垃圾回收机制")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"引用计数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引用计数","aria-hidden":"true"}},[this._v("#")]),this._v(" 引用计数")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("f")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" o "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" o2 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  o"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" o2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// o 引用 o2")]),t._v("\n  o2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" o"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// o2 引用 o")]),t._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"xxx"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token function"}},[t._v("f")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("首先要注意我们是在函数作用域中讨论的这个问题，而不是全局环境中。老版本的IE中的非"),s("code",[this._v("JavaScript")]),this._v("原生对象如 "),s("code",[this._v("DOM")]),this._v(" 和 "),s("code",[this._v("BOM")]),this._v(" 对象就采用的这种引用计数的策略。下面这种情况下就会出现内存泄漏：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" el "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"some_element"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Obj "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmyObj"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" el"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someObject "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Obj"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("myObj"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someObject "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"标记清除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标记清除","aria-hidden":"true"}},[this._v("#")]),this._v(" 标记清除")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这个算法假定有一个根（root）的对象；在 "),s("code",[this._v("Javascript")]),this._v(" 里，根是全局对象,对应于浏览器环境的 "),s("code",[this._v("window")]),this._v("， node环境的 "),s("code",[this._v("global")]),this._v("。垃圾回收器将定期从根开始，找所有从根开始引用的对象，然后找这些对象引用的对象…… 从根开始，垃圾回收器将找到所有可以获得的对象和收集所有不能获得的对象。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"常见的内存泄漏举例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的内存泄漏举例","aria-hidden":"true"}},[this._v("#")]),this._v(" 常见的内存泄漏举例")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"忘记声明的局部变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#忘记声明的局部变量","aria-hidden":"true"}},[this._v("#")]),this._v(" 忘记声明的局部变量")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("a")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    b"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("\n    console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'b没有被声明!'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("b")]),this._v(" 没被声明,会变成一个全局变量,在页面关闭之前不会被释放.使用严格模式可以避免。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"闭包带来的内存泄漏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#闭包带来的内存泄漏","aria-hidden":"true"}},[this._v("#")]),this._v(" 闭包带来的内存泄漏")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" leaks "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" leak "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'xxxxxx'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{attrs:{class:"token comment"}},[t._v("// 闭包中引用，不会被回收")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("leak"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"移除dom节点时候忘记移除暂存的值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#移除dom节点时候忘记移除暂存的值","aria-hidden":"true"}},[this._v("#")]),this._v(" 移除DOM节点时候忘记移除暂存的值")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(180),alt:"domleak0"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(181),alt:"dom leak"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(182),alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("黄色是指直接被 js变量所引用，在内存里")]),this._v(" "),s("li",[this._v("红色是指间接被 js变量所引用，如上图，refB 被 refA 间接引用，导致即使 refB 变量被清空，也是不会被回收的")]),this._v(" "),s("li",[this._v("子元素 refB 由于 parentNode 的间接引用，只要它不被删除，它所有的父元素（图中红色部分）都不会被删除")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"被遗忘的计时器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#被遗忘的计时器","aria-hidden":"true"}},[this._v("#")]),this._v(" 被遗忘的计时器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 JavaScript 中使用 "),s("code",[this._v("setInterval")]),this._v(" 非常平常。一段常见的代码：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" someResource "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getData")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" node "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Node'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// 处理 node 和 someResource")]),t._v("\n        node"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("stringify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("someResource"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("此例说明了什么：与节点或数据关联的计时器不再需要，"),s("code",[this._v("node")]),this._v(" 对象可以删除，整个回调函数也不需要了。可是，计时器回调函数仍然没被回收（计时器停止才会被回收）。同时，"),s("code",[this._v("someResource")]),this._v(" 如果存储了大量的数据，也是无法被回收的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"chrome中查看"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chrome中查看","aria-hidden":"true"}},[this._v("#")]),this._v(" chrome中查看")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("老版本的在 "),s("code",[this._v("Timeline")]),this._v(" 中查看, 新版本的在 "),s("code",[this._v("performance")]),this._v(" 中查看：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/BooheeFE/weekly/master/assets/img/memory.jpeg",alt:"image"}})])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[t._v("打开开发者工具 "),a("code",[t._v("Performance")])]),t._v(" "),a("li",[t._v("勾选 "),a("code",[t._v("Screenshots")]),t._v(" 和 "),a("code",[t._v("memory")])]),t._v(" "),a("li",[t._v("左上角小圆点开始录制(record)")]),t._v(" "),a("li",[t._v("停止录制")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("图中 "),s("code",[this._v("Heap")]),this._v(" 对应的部分就可以看到内存在周期性的回落也可以看到垃圾回收的周期，如果垃圾回收之后的最低值(我们称为min)，min在不断上涨，那么肯定是有较为严重的内存泄漏问题。")])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("参考文章：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/BooheeFE/weekly/issues/8",target:"_blank",rel:"noopener noreferrer"}},[t._v("javaScript中的垃圾回收和内存泄漏"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://speakerdeck.com/addyosmani/javascript-memory-management-masterclass",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript Memory Management Masterclass"),a("OutboundLink")],1)]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("对于全局变量，它的生命周期会持续到页面关闭（这就涉及到了后面要总结的内存泄漏的一种方式）。")]),t._v(" "),a("p",[t._v("而对于局部变量，在所在的函数的代码执行之后，局部变量的生命周期结束。它所占用的内存会通过垃圾回收机制释放（即垃圾回收）。")]),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("垃圾回收通常有两种方式来实现：")]),t._v(" "),t._m(5),t._v(" "),a("p",[t._v('这种算法在MDN文档中被称为最"天真"的垃圾回收算法；核心原理是: 判断一个对象是否要被回收就是要看是否还有引用指向它，如果是"零引用"，那么就回收。说这种算法天真，是因为它存在着较为严重的缺陷---循环引用：')]),t._v(" "),t._m(6),a("p",[t._v("这样当f()执行完本该释放o和o2两个变量，但是由于引用计数的缘故，本没有释放。")]),t._v(" "),t._m(7),t._v(" "),t._m(8),a("p",[t._v("当然我们可以在不用的时候手动释放：")]),t._v(" "),t._m(9),t._m(10),t._v(" "),a("p",[t._v("这个算法把“对象是否不再需要”简化定义为“对象是否可以获得”。")]),t._v(" "),t._m(11),t._v(" "),a("p",[t._v("这个算法相对于引用计数的优势在于，“有零引用的对象”总是不可获得的，但是相反却不一定，参考“循环引用”。")]),t._v(" "),a("p",[t._v("从2012年起，所有现代浏览器都使用了标记-清除垃圾回收算法，都是在此基础上进行优化。所有对JavaScript垃圾回收算法的改进都是基于标记-清除算法的改进，并没有改进标记-清除算法本身和它对“对象是否不再需要”的简化定义。")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),a("p",[t._v("当然有时候我们是故意让这个变量保存在内存中的，但是要避免无意的时候造成的内存泄漏。")]),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("如图：")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),a("p",[t._v("意思就是说子节点还保持着对父节点的引用，所以当父节点被remove掉时，并没有回收掉，需要把子节点设为null方可回收。")]),t._v(" "),a("p",[t._v("下面这个动图可以加深理解：")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("步骤:")]),t._v(" "),t._m(30),t._v(" "),t._m(31)])},n,!1,null,null,null);s.default=r.exports}}]);